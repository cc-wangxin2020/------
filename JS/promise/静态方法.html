<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        function MyPromiseAll(arr) {
            if (arr instanceof Array) {
                return new Promise((resolve, reject) => {
                    let res = []
                    let count = 0
                    for (let i = 0; i < arr.length; i++) {
                        Promise.resolve(arr[i]).then((value) => {
                            count++
                            res[i] = value
                            if (count === arr.length) {
                                resolve(res)
                            }
                        }, (err) => {
                            reject(err)
                        })
                    }
                })
            } else {
                throw Error('输入的参数非数组！！')
            }
        }

        function MyPromiseAny(arr) {
            if (arr instanceof Array) {
                return new Promise((resolve, reject) => {
                    let res = []
                    let count = 0
                    for (let i = 0; i < arr.length; i++) {
                        Promise.resolve(arr[i]).then(value => {
                            resolve(value)
                        }, (err) => {
                            count++
                            res[i] = err
                            if (count === arr.length) {
                                reject(res)
                            }
                        })
                    }
                })
            } else {
                throw Error('输入参数非数组！！')
            }
        }

        function MyPromiseRace(arr) {
            if (arr instanceof Array) {
                return new Promise((resolve, reject) => {
                    for (let i of arr) {
                        Promise.resolve(i).then((value) => {
                            resolve(value)
                        }, (err) => {
                            reject(err)
                        })
                    }
                })
            } else {
                throw Error('输入的参数为非数组！！')
            }
        }

        function MyPromiseAllSettled(arr) {
            if (arr instanceof Array) {
                return new Promise((resolve, reject) => {
                    let res = []
                    let count = 0
                    for (let i = 0; i < arr.length; i++) {
                        Promise.resolve(arr[i]).then((value) => {
                            res[i] = { status: 'fulfilled', value }
                        }, (reason) => {
                            res[i] = { status: 'rejected', reason }
                        }).finally(() => {
                            count++
                            if (count === arr.length) {
                                resolve(res)
                            }
                        })
                    }
                })
            } else {
                throw Error('输入的为非数组！！')
            }
        }
        const p1 = new Promise((resolve) => {
            setTimeout(() => {
                resolve(1)
            }, 100)
        })
        const p2 = Promise.reject(2)
        const p3 = Promise.reject(3)
        let arr = [p1, p2, p3]
        let p = MyPromiseAllSettled(arr)
        p.then((res) => {
            console.log(res);
        }, (err) => {
            console.log(err);
        })
        const ps = Array(10).fill(1).map((v, i) => Promise.resolve(i + 1))
        console.log(ps);
        setTimeout(() => {
            console.log(ps);
        }, 1000)
    </script>
</body>

</html>